// ============================================
// ðŸ“ EXIT POSITION MANAGEMENT
// ============================================
// EXIT ON OPPOSITE SIGNAL
// í¬ì§€ì…˜ ë³´ìœ  ì—¬ë¶€ í™•ì¸
has_long  = strategy.position_size > 0
has_short = strategy.position_size < 0

// ë¡± í¬ì§€ì…˜ ì¡°ê¸° ì²­ì‚° ì¡°ê±´ (ë…¼ë¦¬ì‹ìœ¼ë¡œ í†µí•©)
should_exit_long = has_long and (
     (exit_on_st_flip and ST_S) or
     (exit_on_di_flip and DI_S) or
     (exit_on_macd_flip and MACD_S)
     )

// ìˆ í¬ì§€ì…˜ ì¡°ê¸° ì²­ì‚° ì¡°ê±´ (ë…¼ë¦¬ì‹ìœ¼ë¡œ í†µí•©)
should_exit_short = has_short and (
     (exit_on_st_flip and ST_L) or
     (exit_on_di_flip and DI_L) or
     (exit_on_macd_flip and MACD_L)
     )

// TP/SL ë° ì¡°ê¸° ì²­ì‚° ë¡œì§
if has_long
    if should_exit_long
        strategy.close(id="Long", comment="ExitðŸ”„")
    else
        strategy.exit(id="Exit Long", from_entry="Long",
         limit=use_tp ? long_tp_price : na,
         stop=use_sl ? long_sl_price : na,
         comment_profit="TðŸ‘œP", comment_loss="LâŒSL")

if has_short
    if should_exit_short
        strategy.close(id="Short", comment="ExitðŸ”„")
    else
        strategy.exit(id="Exit Short", from_entry="Short",
         limit=use_tp ? short_tp_price : na,
         stop=use_sl ? short_sl_price : na,
         comment_profit="TðŸ§°P", comment_loss="SâŒSL")